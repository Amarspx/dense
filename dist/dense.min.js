/*! Dense | Copyright (C) 2013 Jukka Svahn | http://dense.rah.pw/ | Released under the MIT License */
!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a(jQuery)}(function(a){var b,c={ping:!0,dimensions:!1},d=[],e={},f=/^https?:\/\//,g=/\.\w+$/,h=["image/jpg","image/jpeg","image/png","image/gif","image/bmp"],i=["svg"];e.init=function(j){return a.extend(c,j),1===b&&0===this.is("[data-1x]").length?this:this.not("[data-jquery-dense-original]").each(function(){var c,k,l=a(this),m=e.getImageAttribute.call(this),n=l.attr("src"),o=!1;if(l.not("img")&&(c=a("<img />"),l.append(c),l=c),!m){if(!n||1==b)return;if(k=m.split(".").pop().split(/[\?\#]/).shift(),a.inArray(k,i))return;m=n.replace(g,function(a){return"_"+b+"x"+a}),o=j.ping&&-1===a.inArray(m,d)&&(f.test(m)===!1||-1!==m.indexOf("://"+document.domain))}o===!0&&isLocal===!0?a.ajax({url:m,type:"HEAD"}).done(function(b,c,f){var g=f.getResponseHeader("Content-type").split(";").shift();200!==f.status||null!==g&&-1===a.inArray(g,h)||(d.push(m),l.attr("src",m).data("jquery-dense-original",n),j.dimensions===!0?e.updateDimensions.call(l.get(0)):l.removeAttr("width").removeAttr("height"))}):(l.attr("src",m).data("jquery-dense-original",n),j.dimensions===!0?e.updateDimensions.call(l.get(0)):l.removeAttr("width").removeAttr("height"))})},e.updateDimensions=function(){return this.each(function(){var b=new Image,c=a(this);b.src=c.attr("src"),c.attr("width",b.width).attr("height",b.height)})},e.devicePixelRatio=function(){var b=1;return"undefined"!==a.type(window.devicePixelRatio)?b=window.devicePixelRatio:"undefined"!==a.type(window.matchMedia)&&a.each([1.3,1.5,2,3,4,5,6],function(a,c){var d=["(-webkit-min-device-pixel-ratio: "+c+")","(min--moz-device-pixel-ratio: "+c+")","(-o-min-device-pixel-ratio: "+c+")","(min-resolution: "+c+"dppx)"].join(",");return window.matchMedia(d).matches?void 0:(b=c,!1)}),Math.ceil(b)},e.getImageAttribute=function(){for(var c,d=(a(this).eq(0),!1),e=1;b>=e;e++)c=a(this).attr("data-"+e+"x"),c&&(d=c);return d},b=e.devicePixelRatio(),a.fn.dense=function(b,c){return("string"!==a.type(b)||"function"!==a.type(e[b]))&&(c=b,b="init"),e[b].call(this,c)}});