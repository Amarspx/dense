<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8" />
    <title>Downloading Dense&hellip;</title>
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/3.1.1/css/font-awesome.min.css" />
    <link rel="stylesheet" href="/assets/css/main.css" />
</head>
<body>

    <main id="download-widget">
        <p class="back"><a class="button light" href="/"><i class="icon-home"></i> Back to home</a></p>
        <h1>Preparing <b>Package</b></h1>
        <p>Finding the version for download&hellip;</p>
        <noscript>
            <p>Starting the download requires JavaScript.</p>
        </noscript>
    </main>

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>
    <script>
    (function($)
    {
        var w = $('#download-widget'), lastmod, time;

        $.ajax({url : '/content/package.json'})
            .done(function (data, textStatus, jqXHR)
            {
                if ($.type(data) === 'object' && $.type(data.name) === 'string')
                {
                    lastmod = jqXHR.getResponseHeader('Last-Modified');

                    w.find('h1 b').text(data.title);
                    w.append('<p>Found package meta&hellip;</p>');
                    w.append($('<p>Version <b></b>&hellip;</p>').find('b').text(data.version).end());

                    if (lastmod)
                    {
                        time = new Date(lastmod);

                        if (time.toString() !== 'Invalid Date')
                        {
                            w.append($('<p>Updated on <b></b>&hellip;</p>').find('b').text(time.getFullYear() + '/' + time.getMonth() + '/' + time.getDate()).end());
                        }
                    }

                    var download = '/download/' + data.name + '.v' + data.version + '.zip';

                    w.append($('<p>Starting <a>download</a> in 2 seconds&hellip;</p>').find('a').attr('href', download).end());

                    window.setTimeout(function ()
                    {
                        window.location = download;
                        w.append('<p>Download starting&hellip;</p>');
                    }, 2000);
                }
                else
                {
                    w.append('<p>Unable to find package meta.</p>');
                }
            })
            .fail(function ()
            {
                w.append('<p>Unable to retrieve package meta. Please try again.</p>');
            });
    })(jQuery);
    </script>
</body>
</html>